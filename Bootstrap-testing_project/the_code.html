﻿<!DOCTYPE html>
<html lang="en">
<head>
    <html manifest="inconnect.appcache">
    <title>Bootstrap 0.4</title>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- JS libs -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
<script src="https://www.softcomplex.com/products/tigra_calendar/tcal.js"></script>
<link rel="stylesheet" href="https://www.softcomplex.com/products/tigra_calendar/tcal.css">
<link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
</head>
<body id='body' class="">

<!-- Header -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand">
	  <div style="width:32px; height:25px" href="#">
<?xml version="1.0"?>
<svg viewBox="0 0 180 200" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
 <g>
  <line id="svg_5" y2="18" x2="159" y1="19" x1="15" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="19" stroke="#000000" fill="none"/>
  <line id="svg_6" y2="28" x2="87" y1="152" x1="88" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="19" stroke="#000000" fill="none"/>
  <line id="svg_13" y2="40" x2="107" y1="169" x1="107" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="19" stroke="#000000" fill="none"/>
  <path d="m111,50c1.835999,0 2.601334,0 3.6045,0c0.852669,0 1.816833,0 2.620834,0c0.821999,0 1.853333,0 2.774666,0c0.683998,0 1.683998,0 2.5,0c0.816002,0 2.042831,0 2.689331,0c1.010506,0 1.97467,0 2.926666,0c0.768005,0 1.709335,0 2.400009,0c1.073334,0 1.918442,-0.07383 2.805328,0.2215c0.703751,0.234348 1.617737,0.935402 2.268005,1.342499c0.770248,0.482208 1.626282,0.703709 2.210663,1.237335c0.741302,0.676907 1.544281,1.262897 2.179169,1.698666c0.81015,0.556061 1.133408,1.371895 1.892822,1.900002c0.505005,0.351192 1.541962,0.776379 2.128006,1.120831c1.026276,0.603207 1.608994,1.140827 2.272003,1.725834c0.498657,0.439999 1.362854,1.184402 2.033325,1.697002c0.686813,0.525097 1.358612,1.045647 2.361343,1.556332c0.546356,0.278255 1.569305,0.386436 2.311996,0.942833c0.622955,0.466694 1.163498,1.422295 1.85733,1.931831c0.550262,0.404099 1.385208,0.923332 1.953339,1.461334c0.576126,0.545563 1.329147,1.560287 1.689835,2.143166c0.526428,0.850731 1.039093,1.523323 1.6875,2.1875c0.645462,0.661156 1.131332,1.175446 1.723495,2.071671c0.468735,0.709419 0.965134,1.34407 1.162506,2.113495c0.233963,0.912064 1.038452,1.57402 1.511322,2.248169c0.521851,0.74398 0.641602,1.728523 0.956833,2.420837c0.267166,0.586754 0.832687,1.556396 1.122009,2.379166c0.343887,0.977936 0.305542,1.818222 0.578659,2.799835c0.168152,0.604355 0.598877,1.301956 1.167831,2.164162c0.543808,0.824104 0.610672,1.736168 0.610672,2.521332c0,0.950668 0,1.716003 0,2.710167c0,0.747337 0.00174,1.764694 0.5,2.404503c0.480804,0.617401 0.5,1.5 0.5,2.400002c0,0.900002 0.096375,1.823257 -0.166672,2.766663c-0.190063,0.681641 -0.445236,1.766716 -0.858658,2.386673c-0.483246,0.724648 -1.218948,1.170677 -1.891998,1.730659c-0.60997,0.5075 -1.451904,0.672195 -2.082672,1.236839c-0.659668,0.590515 -1.291183,1.182426 -1.93866,1.8685c-0.579071,0.613602 -1.292465,1.087181 -2.161346,1.489334c-0.662018,0.306404 -1.427322,0.681595 -2.233322,1.287994c-0.660614,0.497025 -1.381866,1.036339 -2.333344,1.5c-0.651703,0.317574 -1.690002,0.486664 -2.3125,0.854172c-0.835236,0.493103 -1.343536,1.377419 -2.041656,1.458328c-0.951523,0.110283 -1.777832,0.020836 -2.679169,0.020836c-0.900009,0 -1.820831,0 -2.785339,0c-0.725327,0 -1.719131,-0.066498 -2.493835,0.020836c-1.012833,0.114182 -1.669189,0.77932 -2.520828,0.958328c-0.880981,0.185181 -1.800003,0.020836 -2.699997,0.020836c-0.900177,0 -1.685333,0 -2.646667,0c-0.839996,0 -1.838669,0 -2.674164,0c-0.583679,0 -1.778839,0 -2.657837,0c-0.807007,0 -1.852005,0 -2.703995,0c-0.942673,0 -1.652878,0.173302 -2.596504,-0.020836c-0.86721,-0.178413 -1.614189,-0.917015 -2.406166,-0.977829c-0.937241,-0.071976 -1.948051,0.007309 -2.704002,-0.001335c-0.910843,-0.010422 -1.613968,-0.543198 -2.510666,-0.878502c-0.850639,-0.318085 -1.700005,-0.206833 -2.400002,-0.621498l-0.804497,-0.447334l-0.862167,-0.21933l-0.833336,-0.333336" id="svg_16" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="19" stroke="#000000" fill="none"/>
 </g>
</svg>
</div>
	  </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Page 2</a>
          </li>
		  <!-- Testing: print in console the date of timer and clear the timer -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dev</a>
            <div class="dropdown-menu" aria-labelledby="dropdown01">
			  <a class="dropdown-item"  onclick="console.log(DB('r'));" >Show timer</a>
              <a class="dropdown-item" onclick="DB('d')">Delete timer</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>

	
<!-- Main form -->
<form class="container" id="form01" data-toggle="validator" role="form" action="server.php" method="post" was-validated>
<div class="jumbotron mt-3">
      <h1>Registration</h1> 
	  <div class="form-group">
		<label for="inputna" class="control-label">Name:</label>
		<input  class="form-control" pattern="[A-Za-zА-Яа-я]+" name="dname" id="inputna" type="text" placeholder="Name" aria-label="Name" required>		
	  </div>	
	  <div class="form-group">
		<label for="inputsu" class="control-label">Surname:</label>		
		<input  class="form-control" pattern="[A-Za-zА-Яа-я]+" name="dsurn" id="inputsu" type="text" placeholder="Surname" aria-label="Surname" required>
	  </div>
	  <div class="form-group">	
		<label for="inputda" class="control-label">Date of birth:</label>	
	  	<input  class="form-control tcal" pattern="(0[1-9]|1[012])/(0[1-9]|1[0-9]|2[0-9]|3[01])/[0-9]{4}" name="ddate" id="inputda" type="date" placeholder="Enter the date" aria-label="date" required>
	  </div>	
	  <div class="form-group">	
		<label for="inputem" class="control-label">Email:</label>
		<input class="form-control" name="dmail" id="inputem" type="email" placeholder="email@example.ex" aria-label="Email" required>
	  </div>	
	  <div class="form-group">	
		<label class="control-label">Gender:</label>
		<span class="input-group-addon" style="text-align:inherit">
      <table style="width:100%">
	  <tr><td>
	  <div class="radio">
        <label><input type="radio" name="dgen" required>Male</label>
      </div>
      </td></tr>
	  <tr><td>
	  <div class="radio">
        <label><input type="radio" name="dgen" required>Female</label>
      </div>
	  </td></tr>
	  </table>
	  </span>
	  </div>
	   <div class="form-group">		 
		<label for="inputch" class="control-label">Number of children:</label>
		 <input  class="form-control" name="dchil" id="inputch" type="number" placeholder="Number" aria-label="Number of children" required>
       </div>	 
	<button class="btn btn-primary" type="submit">Submit form  &raquo;</button>
 </div>
</form>	


<!-- Footer -->
    <nav class="navbar fixed-bottom navbar-expand navbar-dark bg-dark">
      <a class="navbar-brand" href="#">Footer</a>
    </nav>
	

<!-- Message -->
	 <div id="dialog" style='visibility:hidden;' title="Alert">
     <p id='Altext'>You can only register once in a week.</p>
     </div>



<script>
// Editing the Bootstrap Validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var form = document.getElementById('form01');
    form.addEventListener('submit', function(event) {
      if (form.checkValidity() === false) {
        event.preventDefault();
        event.stopPropagation();
      }
	  else { // Aborting the submit process and using checking function instead
	  event.preventDefault();
      event.stopPropagation();
	  submit();
	  }
      form.classList.add('was-validated');
    }, false);
  }, false);
})();
	

// Optimising
ge=function(n) {
var d = document.getElementsByName(n)[0];
return(d);}
parse=function(n,e){
var a;
var s = ge(n).value;
for (var i = 0; i < s.length; i++){
if (s[i]==e) {a=0};
}
return(a);
}
// Checking inputs, can be used any rule
ch=function(n){
if (parse(n,' ')==0) {ge(n).value='';}
}

DB=function(op){ //LocalStorage creat & delete & read / for week timer on the computer = preventing unnecessary server requests
var name = ge('dname').value;
var surn = ge('dsurn').value;
var date = ge('ddate').value;
var mail = ge('dmail').value;
var gend = ge('dgen').checked; if (gend == true){gend = 'male'} else {gend='female'};
var chil = ge('dchil').value;

if (op == "c"){
    var lname=name+surn+date;
	var value=[];
    value[0]=lname;
	value[1]=name;
    value[2]=surn;
    value[3]=date;
	value[4]=mail;
	value[5]=gend;
	value[6]=chil;
	value[7]=Date.parse(Date())+604800000;
 	localStorage.setItem('WeekTimer',JSON.stringify(Date.parse(Date())+604800000)); // In case of storing one per week.
	// If every person can be stored once in a week then value[7] need to be processed with primary key "lname"
	
	//Sending data to Server
var that=$('#form01'),
url=that.attr('action'),
method=that.attr('method'),
data={};
$.ajax({
url:url,
type:method,
data: value,
success: function(response){ /* Process the Response*/ }
});
return false;

}
else if(op == "d") {localStorage.clear();} //Dev - delete timer
else if(op == "r"){                        //Read the timer.
var x = JSON.parse(localStorage.getItem(localStorage.key('WeekTimer'))); //In case of every person savin the primary key "lname" need to be used
return(x)
}}
ge('dname').setAttribute('onchange','ch(name)');
ge('dsurn').setAttribute('onchange','ch(name)');

//Submiting Function
submit=function(){
//Checking the Week timer
var p=0;
if (DB('r')==null){p=1;}
else{
var t=DB('r')[7];
if (t<Date.parse(Date())) {
p=1;
}}
if (p==1){
//Submiting
DB('c');
}
// Week timer error
else {
$( "#dialog" )[0].style.visibility='visible';
// Adding information about date
var d=new Date(DB('r'));
var month = d.getUTCMonth() + 1;
var day = d.getUTCDate();
var year = d.getUTCFullYear();
var time=d.getHours()+':';
var minu=d.getUTCMinutes();
if(minu<10){ minu='0'+minu };
d= day + "/" + month + "/" + year+' '+time+minu;

$( "#Altext" )[0].innerHTML='You can only register once in a week.<br>Wait until: '+d;
$( "#dialog" ).dialog()};
}
</script>
</body>
</html>
